<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üé∞ KPEPE Powerball Lottery</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üê∏</text></svg>">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      :root {
        --primary: #4ade80;
        --primary-dark: #22c55e;
        --purple: #9B59B6;
        --purple-dark: #431A85;
        --orange: #f97316;
        --red: #ef4444;
        --gold: #fbbf24;
        --bg-dark: #0f0f1a;
        --bg-card: #1a1a2e;
        --text-primary: #ffffff;
        --text-secondary: #a0a0b0;
        --border: rgba(255,255,255,0.1);
      }
      body {
        font-family: 'Segoe UI', -apple-system, sans-serif;
        background: var(--bg-dark);
        color: var(--text-primary);
        min-height: 100vh;
        line-height: 1.6;
      }
      .container { max-width: 500px; margin: 0 auto; padding: 16px; }
      
      /* Header */
      .header { text-align: center; padding: 16px 0 20px; }
      .header h1 {
        font-size: 1.8rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--primary), var(--orange));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 4px;
      }
      .header p { color: var(--text-secondary); font-size: 0.9rem; }
      .network-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        background: rgba(251, 191, 36, 0.15);
        color: #fbbf24;
        margin-top: 10px;
      }
      
      /* How to Play Banner */
      .how-to-play {
        background: linear-gradient(135deg, rgba(155, 89, 182, 0.2), rgba(74, 222, 128, 0.1));
        border: 1px solid rgba(155, 89, 182, 0.3);
        border-radius: 12px;
        padding: 12px 16px;
        margin-bottom: 16px;
        font-size: 0.8rem;
      }
      .how-to-play-title {
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .how-to-play-steps {
        display: flex;
        gap: 8px;
        justify-content: space-between;
      }
      .step {
        text-align: center;
        flex: 1;
      }
      .step-num {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--purple);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        font-weight: 700;
        margin-bottom: 4px;
      }
      .step-text { color: var(--text-secondary); font-size: 0.7rem; }
      
      /* Token Prices Bar */
      .token-prices {
        display: flex;
        justify-content: center;
        gap: 16px;
        padding: 12px 16px;
        background: rgba(255,255,255,0.03);
        border: 1px solid var(--border);
        border-radius: 12px;
        margin-bottom: 16px;
      }
      .token-price {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .token-icon {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
      }
      .token-icon.kpepe { background: linear-gradient(135deg, #9B59B6, #431A85); }
      .token-icon.klv { background: linear-gradient(135deg, #4ade80, #22c55e); }
      .token-info { text-align: left; }
      .token-symbol { font-size: 0.75rem; font-weight: 600; color: var(--text-secondary); }
      .token-usd { font-size: 0.9rem; font-weight: 700; }
      .token-usd.kpepe { color: var(--purple); }
      .token-usd.klv { color: var(--primary); }
      
      /* User Status Card */
      .user-status-card {
        display: none;
        background: linear-gradient(135deg, rgba(155, 89, 182, 0.15) 0%, rgba(74, 222, 128, 0.1) 100%);
        border: 1px solid rgba(155, 89, 182, 0.3);
        border-radius: 16px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .user-status-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }
      .user-tier-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 700;
      }
      .user-tier-badge.gold { background: linear-gradient(to right, #431A85, #9B59B6); }
      .user-tier-badge.silver { background: rgba(155, 89, 182, 0.4); }
      .user-tier-badge.bronze { background: rgba(155, 89, 182, 0.25); }
      .user-tier-badge.standard { background: rgba(74, 222, 128, 0.15); }
      .user-balances {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 12px;
      }
      .balance-item {
        background: rgba(0,0,0,0.3);
        border-radius: 10px;
        padding: 10px;
        text-align: center;
      }
      .balance-label { font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 4px; }
      .balance-value { font-size: 1rem; font-weight: 700; }
      .balance-value.holding { color: #4ade80; }
      .balance-value.staked { color: #f97316; }
      .balance-usd { font-size: 0.7rem; color: var(--text-secondary); margin-top: 2px; }
      .user-benefits {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }
      .benefit-item {
        background: rgba(0,0,0,0.3);
        border-radius: 8px;
        padding: 8px;
        text-align: center;
        font-size: 0.75rem;
      }
      .benefit-value { font-size: 0.9rem; font-weight: 700; color: var(--primary); }
      .benefit-label { font-size: 0.65rem; color: var(--text-secondary); margin-top: 2px; }
      
      /* Jackpot Hero */
      .jackpot-card {
        background: linear-gradient(135deg, rgba(74, 222, 128, 0.15) 0%, rgba(249, 115, 22, 0.15) 100%);
        border: 2px solid rgba(74, 222, 128, 0.4);
        border-radius: 24px;
        padding: 24px 20px;
        text-align: center;
        margin-bottom: 20px;
      }
      .jackpot-label { font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 2px; }
      .jackpot-amount { font-size: 2.5rem; font-weight: 900; color: var(--primary); text-shadow: 0 0 30px rgba(74, 222, 128, 0.5); }
      .jackpot-usd { font-size: 1rem; color: var(--text-secondary); margin-top: 4px; }
      
      /* Countdown */
      .countdown-section { margin-top: 16px; }
      .countdown-timer { display: flex; justify-content: center; gap: 10px; }
      .countdown-unit {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 10px 14px;
        min-width: 55px;
      }
      .countdown-value { font-size: 1.3rem; font-weight: 700; color: var(--primary); }
      .countdown-unit-label { font-size: 0.65rem; color: var(--text-secondary); text-transform: uppercase; }
      
      /* Stats */
      .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 16px; }
      .stat-box { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 14px 10px; text-align: center; }
      .stat-value { font-size: 1.2rem; font-weight: 700; color: var(--primary); }
      .stat-label { font-size: 0.65rem; color: var(--text-secondary); text-transform: uppercase; margin-top: 4px; }
      
      /* Cards */
      .lottery-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 20px;
        margin-bottom: 16px;
      }
      .lottery-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
      .lottery-card-title { font-size: 1rem; font-weight: 600; }
      
      /* Number Picker */
      .number-section { margin-bottom: 20px; }
      .number-section-title { font-size: 0.9rem; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
      .number-section-title .badge { font-size: 0.7rem; padding: 2px 10px; border-radius: 10px; background: var(--purple); color: #fff; font-weight: 600; }
      .number-section-title .badge.complete { background: var(--primary); color: #000; }
      
      .number-grid { display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; max-width: 400px; margin: 0 auto 16px; }
      .number-btn {
        width: 38px;
        height: 38px;
        min-width: 38px;
        border-radius: 50%;
        border: 2px solid var(--border);
        background: var(--bg-card);
        color: var(--text-primary);
        font-size: 0.9rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.15s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .number-btn:hover { border-color: var(--purple); background: rgba(155, 89, 182, 0.2); transform: scale(1.1); }
      .number-btn.selected { background: linear-gradient(135deg, var(--purple), var(--purple-dark)); border-color: var(--purple); color: #fff; box-shadow: 0 0 12px rgba(155, 89, 182, 0.6); transform: scale(1.1); }
      .number-btn.powerball { border-color: var(--red); }
      .number-btn.powerball:hover { border-color: var(--red); background: rgba(239, 68, 68, 0.2); }
      .number-btn.powerball.selected { background: linear-gradient(135deg, var(--red), #dc2626); border-color: var(--red); color: #fff; box-shadow: 0 0 12px rgba(239, 68, 68, 0.6); transform: scale(1.1); }
      
      /* Quick Pick Button */
      .quick-pick-btn {
        width: 100%;
        padding: 14px;
        border-radius: 12px;
        border: 2px dashed var(--purple);
        background: rgba(155, 89, 182, 0.1);
        color: var(--purple);
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        margin-bottom: 16px;
        transition: all 0.2s;
      }
      .quick-pick-btn:hover { background: rgba(155, 89, 182, 0.2); border-style: solid; }
      
      /* Ticket Preview */
      .ticket-preview {
        background: linear-gradient(135deg, var(--purple-dark), var(--purple));
        border-radius: 16px;
        padding: 16px;
        margin-bottom: 16px;
        position: relative;
        overflow: hidden;
      }
      .ticket-preview::before {
        content: '';
        position: absolute;
        top: -50%; left: -50%; width: 200%; height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
        animation: shimmer 3s ease-in-out infinite;
      }
      @keyframes shimmer { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.6; } }
      .ticket-preview-content { position: relative; z-index: 1; }
      .ticket-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
      .ticket-title { font-size: 0.85rem; font-weight: 700; }
      .ticket-id { font-size: 0.7rem; opacity: 0.8; }
      .ticket-numbers { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
      .ticket-number {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: rgba(255,255,255,0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        font-weight: 700;
      }
      .ticket-number.powerball { background: var(--red); }
      .ticket-empty { color: rgba(255,255,255,0.5); font-size: 0.75rem; }
      
      /* Quantity Controls */
      .quantity-controls { display: flex; align-items: center; justify-content: center; gap: 16px; margin-bottom: 16px; }
      .qty-btn {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        border: 2px solid var(--border);
        background: transparent;
        color: var(--text-primary);
        font-size: 1.5rem;
        cursor: pointer;
        transition: all 0.2s;
      }
      .qty-btn:hover { border-color: var(--primary); color: var(--primary); }
      .qty-display { text-align: center; }
      .qty-value { font-size: 2rem; font-weight: 800; color: var(--primary); }
      .qty-label { font-size: 0.75rem; color: var(--text-secondary); }
      
      /* Cost Display */
      .cost-display {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px;
        background: rgba(74, 222, 128, 0.1);
        border: 1px solid rgba(74, 222, 128, 0.3);
        border-radius: 12px;
        margin-bottom: 16px;
      }
      .cost-label { font-size: 0.9rem; color: var(--text-secondary); }
      .cost-value { font-size: 1.5rem; font-weight: 800; color: var(--primary); }
      
      /* Buttons */
      .lottery-btn {
        width: 100%;
        padding: 16px;
        border: none;
        border-radius: 14px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
      }
      .lottery-btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: #000;
      }
      .lottery-btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(74, 222, 128, 0.3); }
      .lottery-btn-secondary { background: rgba(255,255,255,0.1); color: var(--text-primary); border: 1px solid var(--border); }
      .lottery-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
      
      /* Prize Table */
      .prize-table { font-size: 0.8rem; }
      .prize-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border); }
      .prize-row:last-child { border-bottom: none; }
      .prize-match { display: flex; align-items: center; gap: 8px; }
      .prize-balls { display: flex; gap: 4px; }
      .prize-ball { width: 22px; height: 22px; border-radius: 50%; background: var(--purple); display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 700; }
      .prize-ball.pb { background: var(--red); }
      .prize-ball.pbplus { background: var(--orange); }
      .prize-amount { font-weight: 600; color: var(--primary); }
      
      /* Wallet */
      .wallet-status { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; border-radius: 30px; font-size: 0.9rem; margin-bottom: 16px; }
      .wallet-status.connected { background: rgba(74, 222, 128, 0.15); color: var(--success); }
      .wallet-status.disconnected { background: rgba(255,255,255,0.05); color: var(--text-secondary); }
      .wallet-address { font-family: monospace; font-size: 0.8rem; background: rgba(0,0,0,0.3); padding: 10px 14px; border-radius: 8px; word-break: break-all; color: var(--primary); margin-bottom: 12px; }
      
      /* Footer */
      .footer { text-align: center; padding: 30px 20px; color: var(--text-secondary); font-size: 0.8rem; }
      .footer a { color: var(--primary); text-decoration: none; }
      
      /* Animations */
      @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
      .pulse { animation: pulse 0.3s ease; }
      
      .spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-right: 8px; }
      @keyframes spin { to { transform: rotate(360deg); } }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>üé∞ KPEPE Powerball</h1>
        <p>Pick 5 numbers + 1 Powerball!</p>
        <div class="network-badge">üîó Testnet Mode</div>
      </div>
      
      <!-- How to Play -->
      <div class="how-to-play">
        <div class="how-to-play-title">üìñ How to Play</div>
        <div class="how-to-play-steps">
          <div class="step">
            <div class="step-num">1</div>
            <div class="step-text">Pick 5 Numbers<br>(1-50)</div>
          </div>
          <div class="step">
            <div class="step-num">2</div>
            <div class="step-text">Pick Powerball<br>(1-20)</div>
          </div>
          <div class="step">
            <div class="step-num">3</div>
            <div class="step-text">Buy Ticket<br>(5 KLV)</div>
          </div>
          <div class="step">
            <div class="step-num">4</div>
            <div class="step-text">Win Prizes<br>üèÜ</div>
          </div>
        </div>
      </div>
      
      <!-- Token Prices -->
      <div class="token-prices">
        <div class="token-price">
          <div class="token-icon kpepe">üê∏</div>
          <div class="token-info">
            <div class="token-symbol">KPEPE</div>
            <div class="token-usd kpepe" id="kpepe-price">$0.0054</div>
          </div>
        </div>
        <div class="token-price">
          <div class="token-icon klv">‚ö°</div>
          <div class="token-info">
            <div class="token-symbol">KLV</div>
            <div class="token-usd klv" id="klv-price">$0.0015</div>
          </div>
        </div>
      </div>
      
      <!-- Jackpot -->
      <div class="jackpot-card">
        <div class="jackpot-label">üéØ Jackpot</div>
        <div class="jackpot-amount"><span id="jackpot-klv">0</span> KLV</div>
        <div class="jackpot-usd" id="jackpot-usd">~$0 USD</div>
        <div class="countdown-section">
          <div class="countdown-timer">
            <div class="countdown-unit"><div class="countdown-value" id="timer-h">00</div><div class="countdown-unit-label">Hours</div></div>
            <div class="countdown-unit"><div class="countdown-value" id="timer-m">00</div><div class="countdown-unit-label">Min</div></div>
            <div class="countdown-unit"><div class="countdown-value" id="timer-s">00</div><div class="countdown-unit-label">Sec</div></div>
          </div>
        </div>
      </div>
      
      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-box"><div class="stat-value" id="stat-tickets">0</div><div class="stat-label">Tickets</div></div>
        <div class="stat-box"><div class="stat-value" id="stat-players">0</div><div class="stat-label">Players</div></div>
        <div class="stat-box"><div class="stat-value" id="stat-pool">0</div><div class="stat-label">Pool KLV</div></div>
      </div>
      
      <!-- Wallet -->
      <div class="lottery-card"><div id="wallet-section"></div></div>
      
      <!-- User Status Card -->
      <div class="user-status-card" id="user-status-card">
        <div class="user-status-header">
          <span style="font-weight: 600;">üë§ Your Status</span>
          <div class="user-tier-badge standard" id="user-tier-badge">üíö Standard</div>
        </div>
        <div class="user-balances">
          <div class="balance-item">
            <div class="balance-label">Holding</div>
            <div class="balance-value holding" id="user-holding">0</div>
            <div class="balance-usd" id="user-holding-usd">$0</div>
          </div>
          <div class="balance-item">
            <div class="balance-label">Staked</div>
            <div class="balance-value staked" id="user-staked">0</div>
            <div class="balance-usd" id="user-staked-usd">$0</div>
          </div>
        </div>
        <div class="user-benefits">
          <div class="benefit-item">
            <div class="benefit-value" id="user-ticket-price">5 KLV</div>
            <div class="benefit-label">Your Ticket Price</div>
          </div>
          <div class="benefit-item">
            <div class="benefit-value" id="user-free-available">0</div>
            <div class="benefit-label">Free Tickets</div>
          </div>
        </div>
        <div id="free-tickets-info" style="margin-top: 10px; padding: 10px; background: rgba(155, 89, 182, 0.1); border-radius: 8px; font-size: 0.75rem; color: var(--text-secondary); display: none;">
          <div style="color: var(--purple); font-weight: 600; margin-bottom: 6px;">üéÅ Free Tickets from Staking</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;">
            <div>Staking Bonus: <span id="staking-bonus" style="color: var(--orange); font-weight: 600;">0</span>/day</div>
            <div>Unlocked: <span id="free-unlocked" style="color: var(--primary); font-weight: 600;">0</span></div>
          </div>
          <div style="border-top: 1px solid rgba(155, 89, 182, 0.2); padding-top: 6px;">
            <div>Total Free: <span id="free-total" style="color: #fff; font-weight: 600;">0</span></div>
            <div style="margin-top: 4px; color: var(--text-secondary);">üí° Buy paid tickets to unlock free ones!</div>
          </div>
        </div>
        <div id="no-free-info" style="margin-top: 10px; padding: 10px; background: rgba(74, 222, 128, 0.1); border-radius: 8px; font-size: 0.75rem; display: none;">
          <div style="color: var(--primary); font-weight: 600; margin-bottom: 4px;">üéüÔ∏è No Free Tickets Yet</div>
          <div>Stake 25K+ KPEPE to earn free tickets daily!</div>
        </div>
      </div>
      
      <!-- Number Selection -->
      <div class="lottery-card" id="betting-section">
        <div class="lottery-card-header">
          <span class="lottery-card-title">üé´ Your Numbers</span>
          <span style="font-size: 0.75rem; color: var(--text-secondary);">Pick 5 + Powerball</span>
        </div>
        
        <!-- Main Numbers (1-50) -->
        <div class="number-section">
          <div class="number-section-title">
            Main Numbers <span class="badge" id="main-count">0/6 selected</span>
          </div>
          <div class="number-grid" id="main-numbers"></div>
        </div>
        
        <!-- Powerball (1-20) -->
        <div class="number-section">
          <div class="number-section-title" style="color: var(--red);">
            üî¥ Powerball <span class="badge" id="pb-count">0/1 selected</span>
          </div>
          <div class="number-grid" id="powerball-numbers"></div>
        </div>
        
        <button class="quick-pick-btn" onclick="quickPick()">üé≤ Quick Pick (Random Numbers)</button>
        
        <!-- Ticket Preview -->
        <div class="ticket-preview" id="ticket-preview">
          <div class="ticket-preview-content">
            <div class="ticket-header">
              <span class="ticket-title">üé∞ Your Ticket</span>
              <span class="ticket-id" id="ticket-id">#------</span>
            </div>
            <div class="ticket-numbers" id="ticket-numbers">
              <span class="ticket-empty">Pick numbers or use Quick Pick</span>
            </div>
          </div>
        </div>
        
        <!-- Quantity -->
        <div class="quantity-controls">
          <button class="qty-btn" onclick="adjustQuantity(-1)">‚àí</button>
          <div class="qty-display">
            <div class="qty-value" id="ticket-qty">1</div>
            <div class="qty-label">ticket(s)</div>
          </div>
          <button class="qty-btn" onclick="adjustQuantity(1)">+</button>
        </div>
        
        <!-- Cost -->
        <div class="cost-display">
          <span class="cost-label">Total Cost</span>
          <span class="cost-value"><span id="total-cost">5</span> KLV <span id="free-badge" style="display:none; font-size: 0.7rem; background: var(--purple); padding: 2px 6px; border-radius: 8px; margin-left: 8px;">FREE</span></span>
        </div>
        
        <button class="lottery-btn lottery-btn-primary" id="buy-btn" onclick="buyTickets()">
          üéüÔ∏è Buy Ticket(s)
        </button>
        
        <button class="lottery-btn lottery-btn-secondary" id="free-btn" onclick="useFreeTicket()" style="display:none; margin-top: 8px;">
          üéÅ Use Free Ticket (<span id="free-count">0</span> available)
        </button>
      </div>
      
      <!-- Prize Table -->
      <div class="lottery-card">
        <div class="lottery-card-header">
          <span class="lottery-card-title">üèÜ Prize Tiers (KLV)</span>
        </div>
        <div class="prize-table">
          <div class="prize-row">
            <div class="prize-match">
              <div class="prize-balls">
                <div class="prize-ball">5</div>
                <div class="prize-ball pb">PB</div>
              </div>
              <span>Match 5 + Powerball</span>
            </div>
            <span class="prize-amount">üí∞ JACKPOT</span>
          </div>
          <div class="prize-row">
            <div class="prize-match">
              <div class="prize-balls">
                <div class="prize-ball">5</div>
              </div>
              <span>Match 5</span>
            </div>
            <span class="prize-amount">32,500 KLV</span>
          </div>
          <div class="prize-row">
            <div class="prize-match">
              <div class="prize-balls">
                <div class="prize-ball">4</div>
                <div class="prize-ball pb">PB</div>
              </div>
              <span>Match 4 + Powerball</span>
            </div>
            <span class="prize-amount">13,000 KLV</span>
          </div>
          <div class="prize-row">
            <div class="prize-match">
              <div class="prize-balls">
                <div class="prize-ball">4</div>
              </div>
              <span>Match 4</span>
            </div>
            <span class="prize-amount">6,500 KLV</span>
          </div>
          <div class="prize-row">
            <div class="prize-match">
              <div class="prize-balls">
                <div class="prize-ball">3</div>
                <div class="prize-ball pb">PB</div>
              </div>
              <span>Match 3 + Powerball</span>
            </div>
            <span class="prize-amount">3,900 KLV</span>
          </div>
          <div class="prize-row">
            <div class="prize-match">
              <div class="prize-balls">
                <div class="prize-ball">3</div>
              </div>
              <span>Match 3</span>
            </div>
            <span class="prize-amount">3,250 KLV</span>
          </div>
          <div class="prize-row">
            <div class="prize-match">
              <div class="prize-balls">
                <div class="prize-ball">2</div>
                <div class="prize-ball pb">PB</div>
              </div>
              <span>Match 2 + Powerball</span>
            </div>
            <span class="prize-amount">2,600 KLV</span>
          </div>
          <div class="prize-row">
            <div class="prize-match">
              <div class="prize-balls">
                <div class="prize-ball">1</div>
                <div class="prize-ball pb">PB</div>
              </div>
              <span>Match 1 + Powerball</span>
            </div>
            <span class="prize-amount">1,950 KLV</span>
          </div>
          <div class="prize-row">
            <div class="prize-match">
              <div class="prize-balls">
                <div class="prize-ball pb">PB</div>
              </div>
              <span>Powerball only</span>
            </div>
            <span class="prize-amount">1,300 KLV</span>
          </div>
        </div>
        
        <!-- KPEPE Bonus Prizes -->
        <div style="margin-top: 16px; padding-top: 12px; border-top: 1px solid var(--border);">
          <div style="font-size: 0.85rem; font-weight: 600; margin-bottom: 8px; color: var(--purple);">üéÅ KPEPE Bonus Prizes</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">
            <div>Match 4+: <span style="color: var(--primary);">25 KPEPE</span></div>
            <div>Match 5: <span style="color: var(--primary);">100 KPEPE</span></div>
            <div>Match 5 + PB: <span style="color: var(--primary);">500 KPEPE</span></div>
          </div>
        </div>
      </div>
      </div>
      
      <!-- Free Tickets Info -->
      <div class="lottery-card">
        <div class="lottery-card-header">
          <span class="lottery-card-title">üéÅ Free Tickets from Staking</span>
        </div>
        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 12px;">
          Stake KPEPE to earn free tickets daily! Buy paid tickets to unlock them.
        </div>
        <table style="width: 100%; font-size: 0.8rem; border-collapse: collapse;">
          <tr style="border-bottom: 1px solid var(--border);">
            <td style="padding: 8px 4px;">üå± Stake 25K+ KPEPE</td>
            <td style="padding: 8px 4px; text-align: right; color: var(--primary);">1 free ticket/day</td>
          </tr>
          <tr style="border-bottom: 1px solid var(--border);">
            <td style="padding: 8px 4px;">üåø Stake 100K+ KPEPE</td>
            <td style="padding: 8px 4px; text-align: right; color: var(--primary);">5 free tickets/day</td>
          </tr>
          <tr>
            <td style="padding: 8px 4px;">üå≥ Stake 500K+ KPEPE</td>
            <td style="padding: 8px 4px; text-align: right; color: var(--primary);">10 free tickets/day</td>
          </tr>
        </table>
        <div style="margin-top: 12px; padding: 10px; background: rgba(251, 191, 36, 0.1); border-radius: 8px; font-size: 0.75rem; color: var(--gold);">
          üí° Buy N paid tickets to unlock N free tickets!
        </div>
      </div>
      
      <!-- Footer -->
      <div class="footer">
        <p>üé∞ KPEPE Powerball Lottery on KleverChain</p>
        <p style="margin-top: 8px; opacity: 0.6;">Testnet Mode - No real KLV involved</p>
      </div>
    </div>

    <script>
      // Configuration
      const CONTRACT_ADDRESS = 'klv1qqqqqqqqqqqqqpgqsjckgsgeyykgukjx2nn75nr33nsa2ucdvlmsx84e2f';
      const TICKET_PRICE = 650; // KLV (~$1 USD)
      const MAIN_NUMBERS = 50;
      const POWERBALL_NUMBERS = 20;
      const MAIN_PICK = 5; // Pick 5 main numbers + 1 Powerball
      const POWERBALL_PICK = 1;
      
      let walletAddress = null;
      let selectedMainNumbers = [];
      let selectedPowerball = null;
      let ticketQuantity = 1;
      let klvPriceUSD = 0.00154;
      
      // Free ticket system (staking only, unlock with paid purchases, expire daily)
      let stakingBonus = 0; // Free tickets per day from staking
      let dailyFreeTickets = 0; // Free tickets earned today from staking
      let freeTicketsUnlocked = 0; // Free tickets unlocked by buying today
      
      // Initialize
      document.addEventListener('DOMContentLoaded', () => {
        console.log('Initializing lottery...');
        checkDailyReset(); // Reset tickets if new day
        initNumberPickers();
        startCountdown();
        loadStats();
        checkWallet();
        fetchTokenPrices();
      });
      
      // Check and reset daily (tickets expire at midnight)
      function checkDailyReset() {
        const today = new Date().toDateString();
        const savedDate = localStorage.getItem('kpepe_lottery_date');
        
        if (savedDate !== today) {
          // New day - reset daily tickets
          localStorage.setItem('kpepe_lottery_date', today);
          localStorage.setItem('kpepe_lottery_unlocked', '0');
          localStorage.setItem('kpepe_lottery_paid', '0');
        }
        
        // Load saved values
        freeTicketsUnlocked = parseInt(localStorage.getItem('kpepe_lottery_unlocked') || '0');
        paidTicketsInSession = parseInt(localStorage.getItem('kpepe_lottery_paid') || '0');
      }
      
      // Save daily progress
      function saveDailyProgress() {
        localStorage.setItem('kpepe_lottery_unlocked', freeTicketsUnlocked.toString());
        localStorage.setItem('kpepe_lottery_paid', paidTicketsInSession.toString());
      }
      
      // Fetch token prices
      async function fetchTokenPrices() {
        try {
          // Fetch KLV price from CoinGecko (supports CORS)
          const klvRes = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=klever&vs_currencies=usd');
          const klvData = await klvRes.json();
          klvPriceUSD = klvData.klever?.usd || 0.00154;
          document.getElementById('klv-price').textContent = '$' + klvPriceUSD.toFixed(4);
          
          // KPEPE price - use cached or default (CEX API doesn't support browser CORS)
          const cached = localStorage.getItem('kpepe_price_usd');
          if (cached) {
            document.getElementById('kpepe-price').textContent = '$' + parseFloat(cached).toFixed(4);
          } else {
            document.getElementById('kpepe-price').textContent = '$0.0054';
          }
        } catch (e) {
          console.log('Price fetch failed, using defaults');
          document.getElementById('klv-price').textContent = '$0.0015';
          const cached = localStorage.getItem('kpepe_price_usd');
          document.getElementById('kpepe-price').textContent = cached ? '$' + parseFloat(cached).toFixed(4) : '$0.0054';
        }
      }
      
      // Create number pickers
      function initNumberPickers() {
        const mainGrid = document.getElementById('main-numbers');
        const pbGrid = document.getElementById('powerball-numbers');
        
        if (!mainGrid || !pbGrid) {
          console.error('Number grid elements not found!');
          return;
        }
        
        console.log('Creating number pickers...');
        
        // Main numbers 1-50
        for (let i = 1; i <= MAIN_NUMBERS; i++) {
          const btn = document.createElement('button');
          btn.className = 'number-btn';
          btn.textContent = i;
          btn.onclick = () => toggleMainNumber(i, btn);
          mainGrid.appendChild(btn);
        }
        
        // Powerball 1-20
        for (let i = 1; i <= POWERBALL_NUMBERS; i++) {
          const btn = document.createElement('button');
          btn.className = 'number-btn powerball';
          btn.textContent = i;
          btn.onclick = () => togglePowerball(i, btn);
          pbGrid.appendChild(btn);
        }
      }
      
      // Toggle main number
      function toggleMainNumber(num, btn) {
        const index = selectedMainNumbers.indexOf(num);
        if (index > -1) {
          selectedMainNumbers.splice(index, 1);
          btn.classList.remove('selected');
        } else if (selectedMainNumbers.length < MAIN_PICK) {
          selectedMainNumbers.push(num);
          selectedMainNumbers.sort((a, b) => a - b);
          btn.classList.add('selected');
          btn.classList.add('pulse');
          setTimeout(() => btn.classList.remove('pulse'), 300);
        }
        updateUI();
      }
      
      // Toggle powerball
      function togglePowerball(num, btn) {
        if (selectedPowerball === num) {
          selectedPowerball = null;
          btn.classList.remove('selected');
        } else {
          selectedPowerball = num;
          document.querySelectorAll('.number-btn.powerball').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          btn.classList.add('pulse');
          setTimeout(() => btn.classList.remove('pulse'), 300);
        }
        updateUI();
      }
      
      // Quick pick random numbers
      function quickPick() {
        // Clear selections
        selectedMainNumbers = [];
        selectedPowerball = null;
        document.querySelectorAll('.number-btn').forEach(b => b.classList.remove('selected'));
        
        // Pick 5 random main numbers
        while (selectedMainNumbers.length < MAIN_PICK) {
          const num = Math.floor(Math.random() * MAIN_NUMBERS) + 1;
          if (!selectedMainNumbers.includes(num)) {
            selectedMainNumbers.push(num);
          }
        }
        selectedMainNumbers.sort((a, b) => a - b);
        
        // Pick powerball
        selectedPowerball = Math.floor(Math.random() * POWERBALL_NUMBERS) + 1;
        
        // Update UI
        document.querySelectorAll('.number-btn').forEach(btn => {
          const num = parseInt(btn.textContent);
          if (selectedMainNumbers.includes(num)) btn.classList.add('selected');
          if (btn.classList.contains('powerball') && num === selectedPowerball) btn.classList.add('selected');
        });
        
        updateUI();
        
        // Animate ticket preview
        const ticket = document.getElementById('ticket-preview');
        ticket.classList.add('pulse');
        setTimeout(() => ticket.classList.remove('pulse'), 300);
      }
      
      // Update UI
      function updateUI() {
        // Count badges
        const mainBadge = document.getElementById('main-count');
        const pbBadge = document.getElementById('pb-count');
        mainBadge.textContent = `${selectedMainNumbers.length}/${MAIN_PICK}`;
        pbBadge.textContent = `${selectedPowerball ? 1 : 0}/${POWERBALL_PICK}`;
        
        // Add complete class when full
        if (selectedMainNumbers.length === MAIN_PICK) mainBadge.classList.add('complete');
        else mainBadge.classList.remove('complete');
        if (selectedPowerball) pbBadge.classList.add('complete');
        else pbBadge.classList.remove('complete');
        
        // Ticket preview
        const ticketNumbers = document.getElementById('ticket-numbers');
        const ticketId = document.getElementById('ticket-id');
        
        if (selectedMainNumbers.length === 0 && !selectedPowerball) {
          ticketNumbers.innerHTML = '<span class="ticket-empty">Pick numbers or use Quick Pick</span>';
          ticketId.textContent = '#------';
        } else {
          let html = '';
          selectedMainNumbers.forEach(num => {
            html += `<div class="ticket-number">${num}</div>`;
          });
          if (selectedPowerball) {
            html += `<div class="ticket-number powerball">${selectedPowerball}</div>`;
          }
          ticketNumbers.innerHTML = html;
          
          // Generate ticket ID
          const id = Math.random().toString(36).substr(2, 6).toUpperCase();
          ticketId.textContent = `#${id}`;
        }
        
        // Update cost
        const totalCost = ticketQuantity * TICKET_PRICE;
        const available = freeTicketsUnlocked;
        
        // Show/hide free ticket option
        const freeBtn = document.getElementById('free-btn');
        if (available > 0 && selectedMainNumbers.length === MAIN_PICK && selectedPowerball && ticketQuantity === 1) {
          freeBtn.style.display = 'block';
          document.getElementById('free-count').textContent = available;
          document.getElementById('free-badge').style.display = 'inline';
          document.getElementById('total-cost').textContent = '0';
        } else {
          freeBtn.style.display = 'none';
          document.getElementById('free-badge').style.display = 'none';
          document.getElementById('total-cost').textContent = totalCost.toLocaleString();
        }
        
        document.getElementById('ticket-qty').textContent = ticketQuantity;
        
        // Enable/disable buy button
        const buyBtn = document.getElementById('buy-btn');
        const canBuy = selectedMainNumbers.length === MAIN_PICK && selectedPowerball;
        buyBtn.disabled = !canBuy;
        buyBtn.style.opacity = canBuy ? '1' : '0.5';
        buyBtn.textContent = canBuy ? `üéüÔ∏è Buy ${ticketQuantity} Ticket(s)` : 'Pick 5 + Powerball';
      }
      
      // Adjust quantity
      function adjustQuantity(delta) {
        ticketQuantity = Math.max(1, Math.min(100, ticketQuantity + delta));
        updateUI();
      }
      
      // Buy tickets
      function buyTickets() {
        if (selectedMainNumbers.length !== MAIN_PICK || !selectedPowerball) {
          alert('Please select 5 main numbers and 1 Powerball!');
          return;
        }
        
        const totalKLV = ticketQuantity * TICKET_PRICE;
        
        // Buying paid tickets unlocks equal amount of free tickets (up to daily limit)
        paidTicketsInSession += ticketQuantity;
        const remainingDaily = stakingBonus - freeTicketsUnlocked;
        const unlockAmount = Math.min(ticketQuantity, remainingDaily);
        freeTicketsUnlocked += unlockAmount;
        
        // Save progress
        saveDailyProgress();
        
        const totalFreeAvailable = freeTicketsUnlocked;
        
        let message = `üé´ Buying ${ticketQuantity} PAID ticket(s) for ${totalKLV} KLV

Your numbers:
Main: ${selectedMainNumbers.join(', ')}
Powerball: ${selectedPowerball}

Send ${totalKLV} KLV to:
${CONTRACT_ADDRESS}`;
        
        if (stakingBonus > 0) {
          if (unlockAmount > 0) {
            message += `

‚úÖ Unlocked ${unlockAmount} free ticket(s)!
üìä Free tickets today: ${freeTicketsUnlocked}/${stakingBonus}

üí° Tickets reset at midnight!`;
          } else {
            message += `

üìä Already unlocked all ${stakingBonus} free tickets for today!
üí° Come back tomorrow for more free tickets!`;
          }
        }
        
        message += '\n\nGood luck! üçÄ';
        
        alert(message);
        
        // Update stats
        loadStats();
        
        // Reset selections
        selectedMainNumbers = [];
        selectedPowerball = null;
        ticketQuantity = 1;
        document.querySelectorAll('.number-btn').forEach(b => b.classList.remove('selected'));
        updateUI();
        
        // Update user status
        if (walletAddress) updateUserStatus();
      }
      
      // Use free ticket
      function useFreeTicket() {
        const available = freeTicketsUnlocked;
        if (available <= 0) {
          alert('No free tickets available!\n\nüí° Stake KPEPE to earn free tickets.\nThen buy paid tickets to unlock them.\n\nüé´ Tickets reset at midnight!');
          return;
        }
        
        if (selectedMainNumbers.length !== MAIN_PICK || !selectedPowerball) {
          alert('Please select 5 main numbers and 1 Powerball!');
          return;
        }
        
        freeTicketsUnlocked--;
        
        alert(`üé´ Using 1 FREE ticket!

Your numbers:
Main: ${selectedMainNumbers.join(', ')}
Powerball: ${selectedPowerball}

‚úÖ Free tickets remaining: ${freeTicketsUnlocked + stakingBonus}

Good luck! üçÄ`);
        
        // Reset selections
        selectedMainNumbers = [];
        selectedPowerball = null;
        document.querySelectorAll('.number-btn').forEach(b => b.classList.remove('selected'));
        updateUI();
        
        // Update user status
        if (walletAddress) updateUserStatus();
      }
      
      // Use free ticket
      function useFreeTicket() {
        const available = freeTicketsUnlocked;
        if (available <= 0) {
          alert('No free tickets available!\n\nüí° Stake KPEPE to earn free tickets.\nThen buy paid tickets to unlock them.\n\nüé´ Tickets reset at midnight!');
          return;
        }
        
        if (selectedMainNumbers.length !== MAIN_PICK || !selectedPowerball) {
          alert('Please select 5 main numbers and 1 Powerball!');
          return;
        }
        
        freeTicketsUnlocked--;
        saveDailyProgress();
        
        alert(`üé´ Using 1 FREE ticket!

Your numbers:
Main: ${selectedMainNumbers.join(', ')}
Powerball: ${selectedPowerball}

‚úÖ Free tickets remaining: ${freeTicketsUnlocked}

üí° Tickets reset at midnight!

Good luck! üçÄ`);
        
        // Reset selections
        selectedMainNumbers = [];
        selectedPowerball = null;
        document.querySelectorAll('.number-btn').forEach(b => b.classList.remove('selected'));
        updateUI();
        
        // Update user status
        if (walletAddress) updateUserStatus();
      }
      
      // Countdown timer
      function startCountdown() {
        const target = new Date().getTime() + (24 * 60 * 60 * 1000);
        
        function update() {
          const now = new Date().getTime();
          const diff = target - now;
          if (diff <= 0) return;
          
          const h = Math.floor(diff / (1000 * 60 * 60));
          const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
          const s = Math.floor((diff % (1000 * 60)) / 1000);
          
          document.getElementById('timer-h').textContent = String(h).padStart(2, '0');
          document.getElementById('timer-m').textContent = String(m).padStart(2, '0');
          document.getElementById('timer-s').textContent = String(s).padStart(2, '0');
        }
        
        update();
        setInterval(update, 1000);
      }
      
      // Load stats
      function loadStats() {
        document.getElementById('stat-tickets').textContent = '247';
        document.getElementById('stat-players').textContent = '89';
        document.getElementById('stat-pool').textContent = '1,235';
        
        // Jackpot animation
        const jackpot = 2000 + 1235;
        document.getElementById('jackpot-klv').textContent = jackpot.toLocaleString();
        document.getElementById('jackpot-usd').textContent = '$' + (jackpot * klvPriceUSD).toFixed(2) + ' USD';
      }
      
      // Check wallet
      function checkWallet() {
        const saved = localStorage.getItem('klever_wallet');
        if (saved) {
          walletAddress = saved;
          showConnected();
        } else {
          showConnectOptions();
        }
      }
      
      function showConnectOptions() {
        document.getElementById('wallet-section').innerHTML = `
          <div style="text-align: center;">
            <div class="wallet-status disconnected"><span>‚óè</span> Not Connected</div>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 16px;">
              Connect wallet to track your tickets and rewards
            </p>
            <button class="lottery-btn lottery-btn-secondary" onclick="connectWallet()">üîó Connect Wallet</button>
          </div>
        `;
      }
      
      function showConnected() {
        const shortAddr = walletAddress.slice(0, 10) + '...' + walletAddress.slice(-6);
        document.getElementById('wallet-section').innerHTML = `
          <div style="text-align: center;">
            <div class="wallet-status connected"><span>‚úì</span> Connected</div>
            <div class="wallet-address">${shortAddr}</div>
            <button class="lottery-btn lottery-btn-secondary" onclick="disconnect()" style="margin-top: 8px;">Disconnect</button>
          </div>
        `;
        updateUserStatus();
      }
      
      // Update user status card
      async function updateUserStatus() {
        try {
          // Fetch KPEPE balance from Klever API
          const res = await fetch(`https://api.mainnet.klever.org/address/${walletAddress}`);
          const data = await res.json();
          
          const kpepeBalance = data?.balances?.KPEPE?.value || 0;
          const kpepePrice = 0.005371;
          const holdingUSD = (kpepeBalance * kpepePrice).toFixed(2);
          
          // Determine tier and ticket price
          let tier = 'Standard';
          let tierClass = 'standard';
          let ticketPrice = 5;
          
          if (kpepeBalance >= 1000000) {
            tier = 'Gold';
            tierClass = 'gold';
            ticketPrice = 2;
          } else if (kpepeBalance >= 100000) {
            tier = 'Silver';
            tierClass = 'silver';
            ticketPrice = 3;
          } else if (kpepeBalance >= 10000) {
            tier = 'Bronze';
            tierClass = 'bronze';
            ticketPrice = 4;
          }
          
          // Calculate staking bonus (free tickets per day)
          let bonus = 0;
          if (kpepeBalance >= 500000) bonus = 10;
          else if (kpepeBalance >= 100000) bonus = 5;
          else if (kpepeBalance >= 25000) bonus = 1;
          stakingBonus = bonus;
          
          // Show user status card
          document.getElementById('user-status-card').style.display = 'block';
          document.getElementById('user-holding').textContent = kpepeBalance.toLocaleString();
          document.getElementById('user-holding-usd').textContent = '$' + holdingUSD;
          document.getElementById('user-staked').textContent = '0';
          document.getElementById('user-staked-usd').textContent = '$0';
          document.getElementById('user-tier-badge').textContent = tier === 'Gold' ? 'ü•á Gold' : tier === 'Silver' ? 'ü•à Silver' : tier === 'Bronze' ? 'ü•â Bronze' : 'üíö Standard';
          document.getElementById('user-tier-badge').className = 'user-tier-badge ' + tierClass;
          document.getElementById('user-ticket-price').textContent = ticketPrice + ' KLV';
          document.getElementById('user-free-available').textContent = freeTicketsUnlocked;
          
          // Show free ticket info
          const freeInfo = document.getElementById('free-tickets-info');
          const noFreeInfo = document.getElementById('no-free-info');
          
          if (bonus > 0) {
            freeInfo.style.display = 'block';
            noFreeInfo.style.display = 'none';
            document.getElementById('staking-bonus').textContent = bonus;
            document.getElementById('free-unlocked').textContent = freeTicketsUnlocked;
            document.getElementById('free-total').textContent = freeTicketsUnlocked;
          } else {
            freeInfo.style.display = 'none';
            noFreeInfo.style.display = 'block';
          }
          
        } catch (e) {
          console.log('Failed to fetch user status:', e);
        }
      }
      
      async function connectWallet() {
        // For now, just use manual input
        const address = prompt('Enter your Klever wallet address (or use direct transfer):');
        if (address && address.startsWith('klv1')) {
          walletAddress = address;
          localStorage.setItem('klever_wallet', address);
          showConnected();
        } else {
          alert('Invalid address. Try direct transfer instead.');
        }
      }
      
      function disconnect() {
        walletAddress = null;
        localStorage.removeItem('klever_wallet');
        document.getElementById('user-status-card').style.display = 'none';
        showConnectOptions();
      }
    </script>
  </body>
</html>
